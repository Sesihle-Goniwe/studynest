<div class="studygroup-container">
  <h2>Create a New Study Group</h2>
  <form (ngSubmit)="createGroup()" #groupForm="ngForm" class="create-group-form">
    <input
      type="text"
      [(ngModel)]="newGroupName"
      name="name"
      placeholder="Enter group name"
      required
    />
    <input
      type="text"
      [(ngModel)]="newGroupDescription"
      name="description"
      placeholder="Enter group description"
      required
    />
    <button type="submit" [disabled]="!groupForm.form.valid">Create Group</button>
  </form>

  <h2>My Study Groups</h2>
<div *ngIf="memberGroups.length > 0; else noMemberGroups">
  <ul>
    <li *ngFor="let item of memberGroups" class="group-item">
      
      <!-- If currently editing this group -->
      <div *ngIf="editingGroup?.id === item.group.id; else viewMode">
        <input 
          type="text" 
          [(ngModel)]="editName" 
          placeholder="Edit group name"
        />
        <input 
          type="text" 
          [(ngModel)]="editDescription" 
          placeholder="Edit description"
        />
        <button (click)="saveEdit()">Save</button>
        <button (click)="cancelEdit()">Cancel</button>
      </div>

      <!-- Normal display mode -->
      <ng-template #viewMode>
        <strong>{{ item.group.name }}</strong>
        <span class="role">({{ item.role }})</span>
        <p>{{ item.group.description || 'No description yet' }}</p>

        <button (click)="viewGroup(item.group.id)">Group Session</button>
        <button (click)="viewGroupChat(item.group.id, item.group.name)">Group Chat</button>
        <button (click)="viewGroupGoals(item.group.id)">Group Goals</button>

        <!-- Admin-only actions -->
        <button *ngIf="item.role === 'admin'" (click)="startEdit(item.group)">
          Edit Group
        </button>
        <button *ngIf="item.role === 'admin'" (click)="deleteGroup()">
          Delete Group
        </button>

         <button *ngIf="item.role === 'admin'" (click)="setGroupGoals(item.group.id)">
          Set Group Goals
         </button>

         <!-- Show input field when setting goal for this group -->
        <div *ngIf="settingGoalForGroupId === item.group.id" class="set-goal-container">
          <textarea
            placeholder="Enter group goal"
            [(ngModel)]="goalInput"
            rows="4"
          ></textarea>
          <button (click)="submitGoal()" [disabled]="!goalInput.trim()">Submit Goal</button>
          <button (click)="settingGoalForGroupId = null">Cancel</button>
        </div>

        <!-- Show group goals -->
        <div *ngIf="groupGoals[item.group.id] && groupGoals[item.group.id].length > 0">
          <h4>Goals:</h4>
          <ul>
            <li *ngFor="let goal of groupGoals[item.group.id]">
              {{ goal.title }} 
            </li>
          </ul>
        </div>

        <!-- Show message if no goals -->
        <div *ngIf="groupGoals[item.group.id] && groupGoals[item.group.id].length === 0">
          <p>No goals set for this group yet.</p>
        </div>

      </ng-template>
    </li>
  </ul>
</div>

  <ng-template #noMemberGroups>
    <p>You are not a member of any study groups yet.</p>
  </ng-template>

  <h2>Other Available Study Groups</h2>
  <div *ngIf="nonMemberGroups.length > 0; else noOtherGroups">
    <ul>
      <li *ngFor="let group of nonMemberGroups" class="group-item">
        <strong>{{ group.name }}</strong>
        <p>{{ group.description || 'No description yet' }}</p>
        <button (click)="joinGroup(group.id)">Join</button>
      </li>
    </ul>
  </div>
  <ng-template #noOtherGroups>
    <p>There are no other study groups available right now.</p>
  </ng-template>
</div>
